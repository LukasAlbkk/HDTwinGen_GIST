[{"id": "chatcmpl-CS4LydzJKGmP9rtARfCIt1IzfDa4h", "object": "chat.completion", "created": 1760805954, "model": "gpt-4o-mini-2024-07-18", "choices": [{"index": 0, "message": {"role": "assistant", "content": null, "function_call": {"name": "complete_StateDifferential_code", "arguments": "{\"StateDifferential_code\":\"import torch\\nimport torch.nn as nn\\nimport torch.nn.functional as F\\nfrom typing import Tuple\\n\\nclass StateDifferential(nn.Module):\\n\\tdef __init__(self):\\n\\t\\tsuper(StateDifferential, self).__init__()\\n\\t\\tself.mlp = nn.Sequential(\\n\\t\\t\\tnn.Linear(12, 256),\\n\\t\\t\\tnn.LayerNorm(256),\\n\\t\\t\\tnn.LeakyReLU(0.1),\\n\\t\\t\\tnn.Dropout(0.2),\\n\\t\\t\\tnn.Linear(256, 256),\\n\\t\\t\\tnn.LayerNorm(256),\\n\\t\\t\\tnn.LeakyReLU(0.1),\\n\\t\\t\\tnn.Dropout(0.2),\\n\\t\\t\\tnn.Linear(256, 64),\\n\\t\\t\\tnn.LeakyReLU(0.1),\\n\\t\\t\\tnn.Linear(64, 4)\\n\\t\\t)\\n\\t\\tself.treatment_gate = nn.Sequential(\\n\\t\\t\\tnn.Linear(12, 64),\\n\\t\\t\\tnn.LeakyReLU(0.1),\\n\\t\\t\\tnn.Linear(64, 1)\\n\\t\\t)\\n\\n\\tdef forward(self, \\n\\t\\t\\ttumor_size: torch.Tensor,\\n\\t\\t\\tmsi_score: torch.Tensor,\\n\\t\\t\\ttmb_nonsynonymous: torch.Tensor,\\n\\t\\t\\tmitotic_rate: torch.Tensor,\\n\\t\\t\\tage_at_diagnosis: torch.Tensor,\\n\\t\\t\\tstage_encoded: torch.Tensor,\\n\\t\\t\\ttreatment_encoded: torch.Tensor,\\n\\t\\t\\thas_kit_mutation: torch.Tensor,\\n\\t\\t\\ttumor_purity: torch.Tensor,\\n\\t\\t\\tsite_small_intestine: torch.Tensor,\\n\\t\\t\\tsite_stomach: torch.Tensor,\\n\\t\\t\\ttreatment_duration: torch.Tensor) -> Tuple[torch.Tensor, torch.Tensor, torch.Tensor, torch.Tensor]:\\n\\t\\t# Concatenate inputs\\n\\t\\tx = torch.cat((tumor_size, msi_score, tmb_nonsynonymous, mitotic_rate,\\n\\t\\t\\t\\tage_at_diagnosis, stage_encoded, treatment_encoded,\\n\\t\\t\\t\\thas_kit_mutation, tumor_purity, site_small_intestine, site_stomach,\\n\\t\\t\\t\\ttreatment_duration), dim=-1)\\n\\t\\tassert x.shape[-1] == 12, \\\"Input must have last dimension of size 12\\\"\\n\\n\\t\\t# Compute derivatives\\n\\t\\tdynamics = self.mlp(x)\\n\\t\\td_tumor_size__dt, d_msi_score__dt, d_tmb_nonsynonymous__dt, d_mitotic_rate__dt = dynamics.split(1, dim=-1)\\n\\n\\t\\t# Compute treatment gate\\n\\t\\tgamma = F.softplus(self.treatment_gate(x))\\n\\n\\t\\t# Apply treatment effect\\n\\t\\td_tumor_size__dt = d_tumor_size__dt - gamma * treatment_duration\\n\\n\\t\\t# Clamp outputs to physiological ranges\\n\\t\\td_tumor_size__dt = torch.clamp(d_tumor_size__dt, -5, 5)\\n\\t\\td_msi_score__dt = torch.clamp(d_msi_score__dt, -1, 1)\\n\\t\\td_tmb_nonsynonymous__dt = torch.clamp(d_tmb_nonsynonymous__dt, -0.05, 0.05)\\n\\t\\td_mitotic_rate__dt = torch.clamp(d_mitotic_rate__dt, -10, 10)\\n\\n\\t\\t# Sanity checks\\n\\t\\tassert not torch.any(torch.isnan(dynamics)), \\\"Output contains NaN\\\"\\n\\t\\tassert not torch.any(torch.isinf(dynamics)), \\\"Output contains Inf\\\"\\n\\n\\t\\treturn d_tumor_size__dt, d_msi_score__dt, d_tmb_nonsynonymous__dt, d_mitotic_rate__dt\",\"code_description\":\"This code implements a neural ODE-like differential model for simulating treatment responses in GIST, utilizing a hybrid design of mechanistic prior and residual MLP correction.\"}"}, "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1757, "completion_tokens": 934, "total_tokens": 2691, "prompt_tokens_details": {"cached_tokens": 1664, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_560af6e559"}]