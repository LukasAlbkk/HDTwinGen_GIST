# Best model generated by HDTwinGen NSDT
# Environment: Dataset-CBIO
# Seed: 44
# Test MSE: 28.295088
# Val MSE: 31.804470

import torch
import torch.nn as nn
from typing import Tuple

import torch
import torch.nn as nn
from torch.nn import functional as F

class StateDifferential(nn.Module):
	def __init__(self):
		super(StateDifferential, self).__init__()
		self.fc1 = nn.Linear(12, 256)  # Increased hidden layer size
		self.fc2 = nn.Linear(256, 256)
		self.fc3 = nn.Linear(256, 128)
		self.fc4 = nn.Linear(128, 4)    # 4 outputs (derivatives)
		self.dropout = nn.Dropout(0.3)  # Dropout for regularization

	def forward(self,
			tumor_size: torch.Tensor,
			msi_score: torch.Tensor,
			tmb_nonsynonymous: torch.Tensor,
			mitotic_rate: torch.Tensor,
			age_at_diagnosis: torch.Tensor,
			stage_encoded: torch.Tensor,
			treatment_encoded: torch.Tensor,
			has_kit_mutation: torch.Tensor,
			tumor_purity: torch.Tensor,
			site_small_intestine: torch.Tensor,
			site_stomach: torch.Tensor,
			treatment_duration: torch.Tensor) -> Tuple[torch.Tensor, torch.Tensor, torch.Tensor, torch.Tensor]:
		# Concatenate ALL 12 inputs
		x = torch.cat([tumor_size, msi_score, tmb_nonsynonymous, mitotic_rate,
				age_at_diagnosis, stage_encoded, treatment_encoded,
				has_kit_mutation, tumor_purity,
				site_small_intestine, site_stomach,
				treatment_duration], dim=-1)
		x = F.relu(self.fc1(x))
		x = self.dropout(x)  # Apply dropout
		x = F.relu(self.fc2(x))
		x = self.dropout(x)  # Apply dropout
		x = F.relu(self.fc3(x))
		x = self.fc4(x)
		# Split into 4 derivatives
		d_tumor_size__dt, d_msi_score__dt, d_tmb_nonsynonymous__dt, d_mitotic_rate__dt = torch.split(x, 1, dim=-1)
		return (d_tumor_size__dt, d_msi_score__dt, d_tmb_nonsynonymous__dt, d_mitotic_rate__dt)

# Optimized Parameters:
# {}
